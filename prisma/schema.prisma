generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id String @id @default(cuid())
  email String @unique
  name String
  password String
  createdAt DateTime @default(now())

  jobs Job[]
  resume Resume[]
}

model Job {
  id String @id @default(cuid())
  title String
  company String
  location String
  status JobStatus @default(APPLIED)
  salary String?
  description String
  link String?
  notes String?

  userId String
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  resumeEvaluations ResumeEvaluations[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([status])
}

enum JobStatus {
  APPLIED
  INTERVIEW
  OFFERED
  REJECTED
  WITHDRAWN
}

model Resume { 
  id String @id @default(cuid())
  title String
  fileName String
  mimeType String
  fileUrl String
  createdAt DateTime @default(now())
  
  userId String
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  parsedData ResumeParsedData?
  evaluations ResumeEvaluations[]

  @@index([userId])
}

model ResumeParsedData {
  id String @id @default(cuid())

  resumeId String @unique
  resume Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  rawText String
  keywords String[]
  skills String[]

  experience Json
  education Json

  createdAt DateTime @default(now())
}

model ResumeEvaluations {
  id String @id @default(cuid())

  resumeId String
  jobId String

  resume Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)
  job Job @relation(fields: [jobId], references: [id], onDelete: Cascade)

  matchScore Float
  summary String
  strengths String[]
  gaps String[]

  modelUsed String
  promptHash String

  createdAt DateTime @default(now())

  @@unique([resumeId, jobId])
}